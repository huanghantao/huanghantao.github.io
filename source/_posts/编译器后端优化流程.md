---
title: 编译器后端优化流程
date: 2020-11-18 16:56:04
tags:
- 编译器
---

用一个图来总结一下：

```bash
                                                   ┌───────────────────────────────┐                                         
                                                   │                               │                                         
                                                   │      create IRGenerator       │                                         
                                         ┌────────▶│                               │                                         
                                         │         │                               │                                         
                                         │         └───────────────────────────────┘                                         
                                         │                         │                                                         
                                         │                         │                                                         
                                         │                         ▼                                                         
                                         │         ┌───────────────────────────────┐                                         
                                         │         │                               │                                         
                                         │         │create cfg -- ControlFlowGraph │                                         
                                         │         │                               │                                         
┌───────────────────────────────┐        │         │                               │                                         
│                               │        │         └───────────────────────────────┘                                         
│      1. init IRGenerator      │        │                         │                                                         
│                               │────────┤                         │                                                         
│                               │        │                         ▼                                                         
└───────────────────────────────┘        │         ┌───────────────────────────────┐                                         
                │                        │         │   create entry basic block    │                                         
                │                        │         │                               │                                         
                │                        │         │ maybe we should set the block │                                         
                │                        │         │     index and block name      │                                         
                │                        │         └───────────────────────────────┘                                         
                │                        │                         │                                                         
                │                        │                         │                                                         
                │                        │                         │                                                         
                │                        │                         ▼                                                         
                │                        │         ┌───────────────────────────────┐                                         
                │                        │         │                               │                                         
                │                        │         │  add the basic block to cfg   │                                         
                │                        └────────▶│                               │                                         
                │                                  │                               │                                         
                │                                  └───────────────────────────────┘                                         
                │                                                                                                            
                │                                                                                                            
                ▼                                                                                                            
┌───────────────────────────────┐                  ┌───────────────────────────────┐                                         
│                               │                  │                               │                                         
│        2. generate IR         │                  │          expressions          │                                         
│                               │─────────────────▶│                               │◀─┐                                      
│                               │                  │                               │  │                                      
└───────────────────────────────┘                  └───────────────────────────────┘  │                                      
                                                                   │                  │                                      
                                                                   │                  │                                      
                                                                   ▼                  │                                      
                                                   ┌───────────────────────────────┐  │                                      
                                                   │                               │  │                                      
                                                   │  get the current expression   │  │                                      
                                                   │                               │  │                                      
                                                   │                               │  │                                      
                                                   └───────────────────────────────┘  │                                      
                                                                   │                  │                                      
                                                                   │                  │                                      
                                                                   ▼                  │                                      
                                                   ┌───────────────────────────────┐  │     ┌───────────────────────────────┐
                                                   │                               │  │     │   (maybe we should set up a   │
                                                   │  change the expression to IR  │  │     │ mapping between the variable  │
                                                   │                               │──┼────▶│        and the block)         │
                                                   │                               │  │     │                               │
                                                   └───────────────────────────────┘  │     └───────────────────────────────┘
                                                                   │                  │                                      
                                                                   │                  │                                      
                                                                   │                  │                                      
                                                                   ▼                  │                                      
                                                   ┌───────────────────────────────┐  │     ┌───────────────────────────────┐
                                                   │                               │  │     │  we should create new basic   │
                                                   │     add IR to basic block     │  │     │  block for if statement, for  │
                                                   │                               │──┼────▶│           statement           │
                                                   │                               │  │     │                               │
                                                   └───────────────────────────────┘  │     └───────────────────────────────┘
                                                                   │                  │                                      
                                                                   │                  │                                      
                                                                   └──────────────────┘                                      
```
