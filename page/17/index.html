<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>codinghuang的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="比PHP多一些">
<meta property="og:type" content="website">
<meta property="og:title" content="codinghuang的个人博客">
<meta property="og:url" content="http://huanghantao.github.io/page/17/index.html">
<meta property="og:site_name" content="codinghuang的个人博客">
<meta property="og:description" content="比PHP多一些">
<meta property="og:locale">
<meta property="article:author" content="codinghuang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="codinghuang的个人博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">codinghuang的个人博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">简洁些、干净些、直接些...</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://huanghantao.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-手把手教你编写HTTPS客户端" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/07/10/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E7%BC%96%E5%86%99HTTPS%E5%AE%A2%E6%88%B7%E7%AB%AF/" class="article-date">
  <time class="dt-published" datetime="2018-07-09T16:18:04.000Z" itemprop="datePublished">2018-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/07/10/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E7%BC%96%E5%86%99HTTPS%E5%AE%A2%E6%88%B7%E7%AB%AF/">手把手教你编写HTTPS客户端</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天实习的任务计划是写一个HTTPS客户端，我把今天的心得与大家分享一下（不涉及到我们的业务）。</p>
<p>通过这篇博客，你可以理解对称加密算法和非对称加密算法的思想，如何制作证书，以及如何动手编写一个HTTPS服务器和客户端。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/07/10/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E7%BC%96%E5%86%99HTTPS%E5%AE%A2%E6%88%B7%E7%AB%AF/" data-id="ckkj72zuc00a6f6vx2g5sfdn6" data-title="手把手教你编写HTTPS客户端" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-关于不可抢占的操作系统内核" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/07/07/%E5%85%B3%E4%BA%8E%E4%B8%8D%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8/" class="article-date">
  <time class="dt-published" datetime="2018-07-07T15:35:31.000Z" itemprop="datePublished">2018-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/07/07/%E5%85%B3%E4%BA%8E%E4%B8%8D%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8/">关于不可抢占的操作系统内核</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天，我和小伙伴们分享的是关于不可抢占的操作系统内核，目的就是让大家理解一些容易被误解的问题。</p>
<p>首先，我们要知道内核不可抢占的作用是什么？记住一点，为了使得<strong>内核在操作</strong>共享的数据/数据结构的时候，是保持同步的，也就是说数据是保持一致性的。这么说大家理解起来可能会有些困难，我举一个例子。</p>
<p>我们知道，计算机硬件必须提供最少两种不同的执行模式：内核态和用户态。其中，内核态具有较高的特权，用户态具有较低的特权。用户程序在用户态中执行，内核函数（注意，这里我没有说成“内核进程”，至于为什么，我后面会解释）在内核态中执行。OK，知道了这个之后，我们假设有如下情景：我的单CPU单核计算机中有两个进程，分别是进程1和进程2，其中进程1最初是在用户态下执行，在执行的过程中，进程1执行了一个系统调用，进程1的执行模式就从用户态变成了内核态，然后内核函数代替进程1中用户写的函数执行（这也是为什么我前面说成内核函数而不是说成内核进程的原因，因为此时内核函数的执行上下文是进程1，而不是单独为内核函数开一个进程）。那么，此时进程1可能被切换出去然后调度进程2来运行吗？答案是不能。因为我们的进程1是运行在内核态的，而我们这台计算机上面的操作系统内核是不可以被抢占的，所以，进程1不会被切换出去，因此进程2必须要等待进程1回到用户态之后才会被调度执行。既然进程1处于内核态的时候，进程2不会被调度执行，那么内核此时操作的数据结构肯定就是保持一致性的，不会出现不同步的情况了。因此，<strong>内核不可抢占就可以保证进程在内核态操作某个数据data的时候，不会出现其他进程操作这个data的情况</strong>，因此，内核不可抢占其实等价于此时的进程不会被其他进程给抢占。</p>
<p>OK，那么内核不可抢占是否就能保证内核此时操作的数据是保持同步的呢？答案是不能保证。为什么？因为我们这台计算机可能支持<strong>中断</strong>。怎么说呢？虽然内核不可抢占可以保证进程在内核态操作某个数据data的时候，不会出现其他进程操作这个data的情况，但是如果想操作这个data的不是其他进程，而恰恰就是内核本身呢？举个例子：还是同样的单CPU单核计算机，假设进程1是在内核态执行着的，正在操作数据data。此时，中断到来了，那么，CPU就跑去执行中断处理函数（处于内核态，处于中断上下文，不代表任何进程），不幸运的是中断处理函数也去操作数据data了，并且修改了data的值，那么，当进程1重新执行的时候，就会发现数据data是和中断前不一致的，也就是不同步的。（此时的内核不算被抢占了因为，没有其他的进程抢占了进程1的CPU，只不过换了一段内核代码执行而已）</p>
<p>OK，如果我把中断关了的话，内核不可抢占是否就能保证内核此时操作的数据是保持同步的呢？答案是不能保证。为什么？如果我们的计算机是单CPU多核的，内核提供的不可抢占特性就不再有效了。在单CPU单核处理器上，内核可以从容地操作大部分数据结构，不要担心抢占问题。但是在多核CPU上，进程1可能跑在第一个核上面，而进程2可能跑在第二个核上面，且两个进程同时在内核态执行，且都操作同一个数据data，那么，就会出现数据不一致的问题了。此时，内核不可被抢占就无法保证<strong>内核在操作</strong>共享的数据/数据结构的时候数据是一致的。（此时，我们可以借助锁或者其他的同步机制来保证数据的一致性）</p>
<p>好了，讲到这里，大家应该可以理解内核不可被抢占的作用以及它的局限了吧。</p>
<p>happy ending……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/07/07/%E5%85%B3%E4%BA%8E%E4%B8%8D%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8/" data-id="ckkj72zts008bf6vxau5uhi4m" data-title="关于不可抢占的操作系统内核" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-为什么进程需要阻塞态" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/06/16/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%9B%E7%A8%8B%E9%9C%80%E8%A6%81%E9%98%BB%E5%A1%9E%E6%80%81/" class="article-date">
  <time class="dt-published" datetime="2018-06-16T08:25:36.000Z" itemprop="datePublished">2018-06-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/06/16/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%9B%E7%A8%8B%E9%9C%80%E8%A6%81%E9%98%BB%E5%A1%9E%E6%80%81/">为什么进程需要阻塞态</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>好久没有写博客了，因为在外地实习，而我的本地hexo博客是放在旧电脑上面的，最近回学校复习期末才有时间整理博客。所以，今天下午花了一些时间把hexo博客从旧电脑迁移到了新电脑上面。实习期间，我学习到了挺多的东西，最近会慢慢的总结到这个博客上面。</p>
<p>今天，我和大家分享的是与进程状态有关的知识。我们在大学期间，对于进程的几种状态都背的很熟，最基本的三种状态：运行态、就绪态、阻塞态。</p>
<p>运行态很容易理解，就是说这个进程是处于执行状态的。处于运行态的进程是占用CPU的，也就是说CPU此时是在执行这个进程地址空间的代码。</p>
<p>就绪态也比较好理解，就是说这个进程已经准备好了，可以被操作系统的调度器调度，然后投入运行。</p>
<p>OK，说到这里，小伙伴们或许认为进程只需要运行态和就绪态即可。因为我们觉得，进程要么是正在跑（运行态），要么就是还没跑（就绪态）。如果我们的计算机处理的任务都只需要平等的负责计算，那么只有运行态和就绪态或许还可行，此时，这些任务只需要轮流的去被调度即可。因为它们不需要等待任何条件（例如数据有没有到来等等条件），只要被调度了就可以进行计算。</p>
<p>但是，在现实生活中，计算机需要处理的任务不可能都是平等的（也就是说，不可能都是类似的任务），也不可能只需要负责计算即可。打个比方，我们的计算机是单CPU单核的，在这台计算机里面有3个进程。其中，进程1处理的任务是：从0开始，每次自增1，一直自增下去。进程2处理的任务是：从0开始，每次自减1，一直自减下去。进程3处理的任务是：获取网卡中的数据。</p>
<p>从上面三个进程负责的任务可以看出，进程1和进程2处理的任务是类似的（也就是我所说的平等的），并且只需要负责计算即可。而进程3处理的任务就和进程1、进程2的不一样了。它是从外部设备中读取数据，并且当进程3执行<code>read</code>系统调用的时候，此时网卡上面不一定是有数据的，那么，这个进程3接下来该怎么做？是循环执行<code>read</code>系统调用吗？直到网卡上面有数据来了，可读了？显然这样是不好的。因为我们的计算机是单核的，如果这个进程3不停的执行<code>read</code>系统调用，并且网卡始终没有数据，那么就白白浪费了CPU的时间片。所以，操作系统有一个做法是让进程3从运行态变为就绪态，让出CPU给进程1和进程2。但是，这样还是会有一个问题，因为进程3是处于就绪态的，所以，当调度器以后调度进程的时候，还是有可能会选择进程3。如果进程3这个时候可以从网卡中读取数据，那还好说，怕就怕当调度进程3的时候，网卡中还是没有数据可读，那么就白白调度进程3了。所以，操作系统引入一个新的状态–<strong>阻塞态</strong>。调度器不会去调度处于阻塞态的进程，只会去调度处于就绪态的进程（此时，进程1和进程2轮流处于就绪态，所以轮流占用时间片）。当网卡中有数据的时候，进程3才会从阻塞态变为就绪态，所以下次调度器去调度进程的时候，如果调度到了进程3，进程3就可以从网卡中读取数据了。</p>
<p>以上可以用来解释“进程为什么需要阻塞态”。但是，我还想说说其他的东西。</p>
<p>我们都知道，进程1和进程2执行的任务是类似的，所以两个任务是平等的。但是进程3的任务很特殊，需要经常性的等待网卡的数据到来，所以经常性的处于阻塞态。相对另外两个进程来说，进程3得到的CPU的时间在总数上来说是更少的，那么，这对进程3就会有一点点的不公平。</p>
<p>我们可以通过下面的图片来直观的感受一下：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%9B%E7%A8%8B%E9%9C%80%E8%A6%81%E9%98%BB%E5%A1%9E%E6%80%81/1.png"></p>
<p>我们可以发现，进程3在t2那个时刻，是处于就绪态的，但是，调度器并没有去调度进程3，而是先去调度进程1和进程2，后面再来调度进程3。因为，我们假设进程1、进程2和进程3都是平等的，所以，调度器并不会因为进程3很久没有得到执行了，就可怜它一下，让它立刻投入运行。为了更好的处理这个问题，我们可以给进程引入一个优先级的概念，优先级越大，进程就越先被调度。按照这个概念，可想而知，我们希望给进程3分配一个更高的优先级，以让进程3在t2时刻就可以投入运行。</p>
<p>好的，现在我们引入了优先级的概念。可能就有小伙伴们想：进程1和进程2的优先级该怎么分呢？这里，我们一般就是给它们一样的优先级，为什么？因为进程1和进程2要么是处于运行态，要么是处于就绪态。假设进程1的优先级大于进程2的优先级，那么调度器每次从就绪态中的选择一个优先级更大的进程，每次都会去选择进程1（假设进程3处于阻塞状态），这样就会导致进程2饿死（饿死的意思就是进程长时间没有运行）。所以，我们在分配进程优先级的时候，会让进程1和进程2的优先级一样，使得调度器轮流的去调度进程1和进程2。当然，如果你非要让进程1的优先级大于进程2，可以在进程1执行一段时间后，执行<code>sleep</code>系统调用，让进程1主动挂起，处于阻塞状态，这个时候，调度器就会去调度进程2了，其实，这也是进程为什么需要阻塞态。</p>
<p>OK，讲到这里，大家应该是理解了吧。</p>
<p>其实，在对于一个强大的操作系统，是不可能会像我这样分析的那么简单，我这里简单的分析主要是帮助大家理解。新版Linux的调度算法也绝不是仅仅依靠时间片和优先级来实现调度的，感兴趣的小伙伴可以看看Linux的CFS调度算法。还有就是，我上面说的进程3去从网卡读取数据也不严谨，进程3只能够从用户空间的缓冲区中读取数据，而网卡中的数据到达用户空间的缓冲区，是需要借助操作系统的，网卡中的数据先是拷贝到内核缓冲区，然后再从内核缓冲区拷贝到用户空间的缓冲区。当然，我说进程3去读网卡数据是为了方便小伙伴们理解。</p>
<p>等我回去公司之后，我会继续补充这篇博客，通过操作系统的代码，来演示一下优先级和阻塞态的所起到的作用。</p>
<p>happy ending……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/06/16/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%9B%E7%A8%8B%E9%9C%80%E8%A6%81%E9%98%BB%E5%A1%9E%E6%80%81/" data-id="ckkj72zti007jf6vx9xkndicl" data-title="为什么进程需要阻塞态" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-我的腾讯之路" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/19/%E6%88%91%E7%9A%84%E8%85%BE%E8%AE%AF%E4%B9%8B%E8%B7%AF/" class="article-date">
  <time class="dt-published" datetime="2018-04-19T06:50:04.000Z" itemprop="datePublished">2018-04-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/19/%E6%88%91%E7%9A%84%E8%85%BE%E8%AE%AF%E4%B9%8B%E8%B7%AF/">我的腾讯之路</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>很开心，春招拿到了腾讯科恩实验室的offer。这是我大二立下的一个目标，依稀记得大一暑假，我特意跑去了深圳看腾讯大厦，拍了好几张照片～但是不敢进去，不好意思，估计也会被拦下来。我心想，总有一天我要进腾讯，和一群优秀的人一起工作。终于，我实现了这个梦想，而且还是和国内顶尖的黑客们一起工作，挺开心的～</p>
<p>意料之外，也是情理之中。天道酬勤嘛～</p>
<p>现在我来分享下我的经历，希望我的“粉丝”不会失望～</p>
<p>大一的时候，其实我对编程并不感冒，C语言作业也是随便写写，因为我感觉学了C语言不知道可以做什么。写来写去就是一个黑框框弹出来，然后输出一个结果。其实这是因为我对计算机的兴趣还没有被激发出来而导致的。大一的时候我倒是对高数很感兴趣，每天刷题，刷竞赛题，然后拿了一个高数竞赛特等奖。我认为这是我们国家教育的问题，从小刷题，大学还是刷题。实际上很多人并不知道为什么要去刷题。就这样，大一就在刷题中度过了～</p>
<p>到了大一暑假，我开始自学C++，入门书籍是谭浩强的红皮书。看完之后，我对C++的基本语法比较熟悉了。但是，我还是不知道学了C++可以干什么。</p>
<p>到了大二，我报了我们学校的一个社团，叫做物联网基地。那时候，我的人生发生了转折。我不知道我为什么就爱上了编程～在社团里面，我学习了很多其他没有接触过的东西。例如PHP这门语言，这是我写的比较熟悉的语言（现在我可以看看内核代码，写写扩展）。每天我都保持8个小时的学习时间（包括看书和写代码）。大二上学期结束之后，我可以熟练的搭建网站了，是很有成就感的。但是因为人的精力有限，我在学校课程方面的考试能力下降了。学分绩从专业第一直线下滑，甚至差点挂科。但是我不后悔，我相信我坚持下去，我一定会实现我的目标。</p>
<p>到了大二下学期，我有一段时间不知道该学习什么了。因为写网页还挺熟练了，所以我去找学校的资源。我找过我们学校的一个比较厉害的社团，叫做家园网（挺多人进了BAT），想加入他们，增加实战经验。但是由于某个原因，我没有去。后来我去找一个学长。他非常厉害，小学开始写代码，我个人认为他是我们学校最厉害的人。曾经以一人之力，挑战清华、复旦这些名牌学校的整个团队，得了银奖，也是唯一一个211学校的获奖学生。他那时候在创业，我想投奔他，但是因为他公司得搬去深圳了，所以我的计划又失败了。没办法，我只能去网上寻求前辈们的帮助。（因为我们学校的计算机比较差，所以在学校也很难得到提升）其中，对我产生最大影响的是<strong>韩天峰前辈</strong>，他给予了我简短但是很关键性的建议，主要是让我先打好基础，如果足够优秀，校招是可以进腾讯的。于是我按照他的建议，一步一步打好基础。主要是<strong>数据结构、操作系统、计算机网络、计算机组成原理</strong>。为了学些这些知识，我大量阅读书籍和写代码。</p>
<p>大三上学期，我阅读了将近40本专业书籍。特别是操作系统和计算机网络方面的书籍，一些经典书籍看了两三遍。然后算法题我也每天都写3~4题，这样下来，到了春招，我算法题写了将近400题。（顺便参加了蓝桥杯，差点拿省一，有些遗憾）</p>
<p>大三下学期，我密切关注腾讯春招动态。刚好，一个在腾讯的学长在内推，于是我就请求他帮我内推一下。所以，有了参加腾讯面试的机会，我个人认为我是幸运儿。参加腾讯面试还是很快乐的一件事，和面试官交流，可以发现自己不足。比较吃惊的就是二面有4～5个面试官轮流问我问题，哈哈，有了一个展现自我的机会。</p>
<p>面试完之后就是等结果，这是最难熬的了。不过，等来了好消息。</p>
<p>我能够进腾讯的原因总结起来有很多。</p>
<p>个人原因是我专注度比较高，心里没有太多的杂念，不会去做违背自己初心的事情。这里我想给小伙伴们一些建议，就是一定要目标明确，例如，不要一边打算考研，一边又打算找工作。因为人的精力都是有限的，如果同时做两件都很耗时的事情，往往是得不偿失的。还有就是要懂得取舍，其实这个和目标明确是有关联的。例如以后打算直接工作，就不要想着其他事情了，专心写代码，老天一定会眷顾我们的。</p>
<p>外在的原因就是我身边有很多人帮助我，例如在物联网基地的一些学长学姐。特别是一个创业好几年的学长，给予了我特别大的帮助。那时，我一天都待在基地，中午没地方休息，靠在桌子上睡觉手和腿会发麻，特别难受。然后学长他就从他们公司拿来了一张床，我中午就可以在基地休息了。大二暑假他也让我去他那里实习，但是我那时候对计算机底层更加感兴趣，所以他给的任务我也没有完成，最后离开了他公司，心里有些内疚。</p>
<p>还有就是我有一群优秀的室友，他们都是打算法的，而我写算法只是业余爱好，练练脑子的逻辑思维。在写算法的过程中，难免会遇到一些问题，但是有些问题室友会帮我解决，这就节省了很多时间。</p>
<p>然后是内推我的那个学长，也帮助了我很多～</p>
<p>最关键的还是面试官们，他们对我的认可。如果没有认可，无论我做的怎么样，都是没有这个机会的。</p>
<p>其实还有很多人，这里是列举不完的～</p>
<p>实习好好加油～～</p>
<p>最后，祝大家都可以去到自己梦想的公司～</p>
<p>happy ending……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/04/19/%E6%88%91%E7%9A%84%E8%85%BE%E8%AE%AF%E4%B9%8B%E8%B7%AF/" data-id="ckkj72zuc00a3f6vx9s15egh0" data-title="我的腾讯之路" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-外部排序-PHP版本" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/11/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F-PHP%E7%89%88%E6%9C%AC/" class="article-date">
  <time class="dt-published" datetime="2018-04-11T10:55:22.000Z" itemprop="datePublished">2018-04-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/11/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F-PHP%E7%89%88%E6%9C%AC/">外部排序--PHP版本</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>发现网上搜不到PHP版本的外部排序，有点心疼。所以打算自己写一个，这里和大家分享下。这应该是网上第一个PHP版本的外部排序。</p>
<p>小伙伴们应该都写过或者听过一些排序算法，例如：<code>冒泡排序</code>、<code>选择排序</code>、<code>归并排序</code>、<code>快速排序</code>、<code>堆排序</code>。（建议小伙伴们都要掌握这几种最基本的排序算法，一定要随时可以写出来）</p>
<p>但是对于外部排序不一定都听过。因为学生嘛，平时写的项目大多是玩具，所以很少有大量的数据需要处理，自然就没必要用到外部排序了。</p>
<p>但是，从今天开始，小伙伴们就需要知道什么是外部排序了。</p>
<p>是这样的，一般我们要排序的数据量都很小，所以写个快速排序呀等等排序算法就可以把数据排好。而且这些排序算法都有一个特点，就是<strong>只用到了内存</strong>，因此这些算法被称为内部排序。而<strong>外部排序就是在排序过程中用到了外存，例如磁盘</strong>。为什么需要用到外存？因为需要排序的数据量很大，例如好几十个G，但是可使用的内存却只有几个G，因此，我们不能直接使用内部排序，需要借助外存来完成整个排序的过程。</p>
<h2 id="外部排序总体思路"><a href="#外部排序总体思路" class="headerlink" title="外部排序总体思路"></a>外部排序总体思路</h2><p>1、从整个大文件里面循环读取一定量的数据到内存里面，然后把这部分数据排好序之后，写入一个小文件。达到把整个大文件分割成一定量的小文件的目的。</p>
<p>2、因为每个小文件里面的数据都是已经排好序的了，所以可以对小文件进行归并的操作，最终得到的大文件就是完全排好序的。</p>
<h2 id="开始实现"><a href="#开始实现" class="headerlink" title="开始实现"></a>开始实现</h2><p>首先我们定义了一些接口和类，来方便我们完成对文件的一些读写操作。</p>
<p>FileInterface.php文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">FileInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">$file</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SortingAlgorithmInterface.php文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SortingAlgorithmInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sort</span>(<span class="params">$outputPath</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>File.php文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> <span class="keyword">implements</span> <span class="title">FileInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> $file;</span><br><span class="line">	<span class="keyword">public</span> $list = [];</span><br><span class="line">	<span class="keyword">public</span> $fileSize;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;fileSize = filesize($file); <span class="comment">// 得到文件大小</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">$offset= <span class="number">0</span>, $maxlen = <span class="number">500000</span> </span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 将整个文件读入一个字符串</span></span><br><span class="line">		$list = file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">		<span class="keyword">$this</span>-&gt;list = explode(<span class="string">&#x27;,&#x27;</span>, $list); <span class="comment">// 将字符串打散为数组</span></span><br><span class="line">		$list = <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">$file</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 打开文件$file，如果不存在则创建它</span></span><br><span class="line">		$file = fopen($file, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">        <span class="comment">// 把排好序的数组合并成字符串后写入文件</span></span><br><span class="line">		$string = fwrite($file, implode(<span class="string">&quot;\n&quot;</span>, <span class="keyword">$this</span>-&gt;list) );</span><br><span class="line">		fclose($file);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里提一点，在<code>write</code>方法中，我使用了<code>implode(&quot;\n&quot;, $this-&gt;list)</code>，也就是说通过<code>&quot;\n&quot;</code>来对数组元素进行连接，写入文件里面。使用<code>&quot;\n&quot;</code>的原因是为了方便从文件中读取一个值。</p>
<p>OK，接下来解释关键性的操作了，也就是ModifiedMergeSort.php文件里面的内容。</p>
<p>先来看看ModifiedMergeSort类里面都有什么成员变量：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModifiedMergeSort</span> <span class="keyword">implements</span> <span class="title">SortingAlgorithmInterface</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $file;</span><br><span class="line">	<span class="keyword">protected</span> $sizeLimit;</span><br><span class="line">	<span class="keyword">protected</span> $tmpFiles = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$file</code>是用来保存文件对象的，也就是一个<code>File</code>对象。</p>
<p><code>$sizeLimit</code>用来存放我们可以使用多少内存来完成排序的值。</p>
<p><code>$tmpFiles</code>用来保存小文件的文件名。</p>
<p>OK，接下来我们来看看<code>ModifiedMergeSort</code>类里面的<code>sort</code>方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sort</span>(<span class="params">$outputPath = <span class="string">&#x27;output&#x27;</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file-&gt;fileSize &gt; <span class="keyword">$this</span>-&gt;sizeLimit) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;externalSort();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 如果文件在指定的大小范围内, 直接在内存中进行排序</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 把文件中的数字读入到数组里面，保存在$this-&gt;file-&gt;list里面</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;file-&gt;read();</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;sorting file\n&quot;</span>;</span><br><span class="line">        <span class="comment">// 对数组中的元素进行排序，排序之后$this-&gt;file-&gt;list就是有序的数组了</span></span><br><span class="line">		sort(<span class="keyword">$this</span>-&gt;file-&gt;list);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;output($outputPath);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>在这里，有一个判断的操作：如果大文件的文件大小要大于我们可以使用的内存大小，则使用外部排序，即调用<code>externalSort</code>方法；否则把整个文件读取到内存中，然后直接在内存中进行内部排序即可。</p>
<p>我们重点看看<code>externalSort</code>方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">externalSort</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 分成小块</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;chunk();</span><br><span class="line">		<span class="comment">// 文件拆分后，将它们按正确的顺序重新组合在一起</span></span><br><span class="line">		<span class="keyword">$this</span>-&gt;mergeFile();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;External sort TBC\n&quot;</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，这就是我们上面写的外部排序总体思路：<strong>先分块，后归并</strong>。</p>
<p>OK，我们来看看如何把一个大文件拆分成多个小文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">chunk</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Splitting file...\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">		$handle = fopen(<span class="keyword">$this</span>-&gt;file-&gt;file, <span class="string">&quot;r&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get handle&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ($handle) &#123;</span><br><span class="line"></span><br><span class="line">			$tmpNum = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 检测文件指针是否已到达文件末尾</span></span><br><span class="line">		    <span class="keyword">while</span> (!feof($handle)) &#123;</span><br><span class="line">		        $buffer = fgets($handle, <span class="keyword">$this</span>-&gt;sizeLimit);</span><br><span class="line"></span><br><span class="line">		        $list = explode(<span class="string">&#x27;,&#x27;</span>, $buffer);</span><br><span class="line"></span><br><span class="line">		        <span class="comment">// 在把数据保存在临时文件之前排序</span></span><br><span class="line">		        <span class="comment">// $list数组里面是已经排好序的了</span></span><br><span class="line">		        sort($list);</span><br><span class="line"></span><br><span class="line">		        <span class="comment">// 移除空域</span></span><br><span class="line">		        <span class="keyword">$this</span>-&gt;file-&gt;list = array_filter($list);</span><br><span class="line"></span><br><span class="line">		        $fileName = <span class="string">&#x27;tmp-&#x27;</span> . $tmpNum . <span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line"></span><br><span class="line">		        <span class="keyword">$this</span>-&gt;file-&gt;write(<span class="string">&quot;output/<span class="subst">$fileName</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">		        <span class="keyword">$this</span>-&gt;tmpFiles[] = $fileName;</span><br><span class="line"></span><br><span class="line">		        ++$tmpNum;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// fstat() 函数返回关于打开文件的信息，fstat($handle)[&#x27;size&#x27;]是文件大小</span></span><br><span class="line">		        <span class="comment">// $this-&gt;tmpFiles[$fileName][&#x27;size&#x27;] = fstat($handle)[&#x27;size&#x27;];</span></span><br><span class="line"></span><br><span class="line">		        <span class="keyword">echo</span> <span class="string">&quot;New file: output/<span class="subst">$fileName</span>\n&quot;</span>;</span><br><span class="line">		    &#125;</span><br><span class="line"></span><br><span class="line">		    fclose($handle);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>重点看while循环里面的内容。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$buffer = fgets($handle, <span class="keyword">$this</span>-&gt;sizeLimit);</span><br></pre></td></tr></table></figure>

<p>也就是说，我们每次循环都读取<code>sizeLimit</code>字节的数据。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$list = explode(<span class="string">&#x27;,&#x27;</span>, $buffer);</span><br></pre></td></tr></table></figure>

<p>也就是说，我们把由这些数据构成的字符串变成数组。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort($list);</span><br></pre></td></tr></table></figure>

<p>也就是说，对这个数组从小到大进行排序。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$fileName = <span class="string">&#x27;tmp-&#x27;</span> . $tmpNum . <span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;file-&gt;write(<span class="string">&quot;output/<span class="subst">$fileName</span>&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>也就是说，把排好序的数据写入小文件。小文件的命名格式是<code>tmp-第几个小文件-.txt</code>。</p>
<p>OK，完成了文件拆分，接下来是归并的过程。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">mergeFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;正在归并...\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断归并是否结束</span></span><br><span class="line">    $flag_num = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 最小数字的文件索引</span></span><br><span class="line">    $min_data_index = <span class="number">-1</span>;</span><br><span class="line">    <span class="comment">// 最小数字</span></span><br><span class="line">    $min_data = PHP_INT_MAX;</span><br><span class="line"></span><br><span class="line">    $little_file_nums = count(<span class="keyword">$this</span>-&gt;tmpFiles);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用来存放所有小文件的文件句柄</span></span><br><span class="line">    $handle = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用来存放大文件的文件句柄</span></span><br><span class="line">    $big_file_handle = fopen(<span class="string">&#x27;output/big_file.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">    <span class="comment">// 用来存放小文件的第一个数字，即该文件的最小值</span></span><br><span class="line">    $first_data = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $little_file_nums; ++$i) &#123;</span><br><span class="line">        $handle[$i] = fopen(<span class="string">&#x27;output/&#x27;</span> . <span class="keyword">$this</span>-&gt;tmpFiles[$i], <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $little_file_nums; ++$i) &#123;</span><br><span class="line">        $first_data[$i] = (<span class="keyword">int</span>)fgets($handle[$i]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($min_data &gt; $first_data[$i]) &#123;</span><br><span class="line">            $min_data_index = $i;</span><br><span class="line">            $min_data = $first_data[$i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fwrite($big_file_handle, $min_data);</span><br><span class="line">    fwrite($big_file_handle, <span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123; <span class="comment">// 文件全部读取完毕</span></span><br><span class="line">        $first_data[$min_data_index] = (<span class="keyword">int</span>)fgets($handle[$min_data_index]);</span><br><span class="line">        <span class="keyword">if</span> ($first_data[$min_data_index] == <span class="literal">false</span>) &#123;</span><br><span class="line">            ++$flag_num;</span><br><span class="line">            $first_data[$min_data_index] = PHP_INT_MAX;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ($flag_num == $little_file_nums) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $min_data_index = <span class="number">-1</span>;</span><br><span class="line">        $min_data = PHP_INT_MAX;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 找出数组中最小的数字</span></span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $little_file_nums; ++$i) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($min_data &gt; $first_data[$i]) &#123;</span><br><span class="line">                $min_data_index = $i;</span><br><span class="line">                $min_data = $first_data[$i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fwrite($big_file_handle, $min_data);</span><br><span class="line">        fwrite($big_file_handle, <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $little_file_nums; ++$i) &#123;</span><br><span class="line">        fclose($handle[$i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里，我们采用的是多路归并排序而不是两路归并排序。</p>
<p>多路归并排序思路：</p>
<ul>
<li>将每个小文件里面的文件指针指向的数读入(由于有序，所以为该文件最小数)，存放在一个first_data数组中；</li>
<li>找出first_data数组中最小的数min_data，及其对应的文件索引index；</li>
<li>把从first_data数组中找到的那个最小的数写入大文件<code>big_file.txt</code>里面，然后更新数组first_data(根据index读取该文件下一个数，来代替min_data)；</li>
<li>判断所有小文件的所有数据是否都读取完毕。如果没有，继续归并操作；如果全部读完了，跳出循环，结束归并的过程。</li>
</ul>
<p>所以，可以得到如下的流程图：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F--PHP%E7%89%88%E6%9C%AC/1.png"></p>
<p>这些步骤中，比较难办的一点就是如何判断所有的数据都读取完毕了。其中，一个最笨的办法就是每次都在循环中判断所有文件的文件指针是否都指向<code>EOF</code>了，如果都指向<code>EOF</code>，那么就说明所有数据读取完毕；否则没有，需要继续读。但是，这样的话，每次都需要对所有的文件指针进行遍历。如果小文件有几万个，那消耗的时间就多了，所以我没有采取这种办法。</p>
<p>于是我问了问我一个打算法比赛的室友，得到了一种思路：因为我们知道小文件一共有多少个，所以我们可以去统计一共有多少个文件的文件指针到达了文件末尾。一旦到达文件末尾的文件指针个数和小文件的个数相等，那么我们就可以判断所有数据被读取完毕了，也就是如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($flag_num == $little_file_nums) &#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OK，我再讲一讲一个细节上的问题：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$first_data[$i] = (<span class="keyword">int</span>)fgets($handle[$i]);</span><br></pre></td></tr></table></figure>

<p>这里对从文件里面读取出来的数据进行了数据类型的转换，原因是：从文件里面读取出来的数字是字符串类型，而字符串类型做大小比较就有些坑了。例如，字符串<code>&quot;123&quot;</code>要比字符串<code>&quot;5&quot;</code>小。</p>
<p>下面是我的测试数据：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F--PHP%E7%89%88%E6%9C%AC/2.png"></p>
<p>（我对一个46兆左右的数据进行排序，使用的内存限制是1兆）</p>
<p>可以看出，耗时为185秒左右，也就是3分钟左右。</p>
<p>好了，外部排序大致就是这样了，其实还是有很大的优化空间的，特别是在归并的过程中，可以使用胜者树，败者树来进行优化。有时间我会补充。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/abdimaye/external-sort">大文件拆分成小文件</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dce6a43d4678">外部排序</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/04/11/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F-PHP%E7%89%88%E6%9C%AC/" data-id="ckkj72zu1009af6vxenxv1i6t" data-title="外部排序--PHP版本" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F/" rel="tag">外部排序</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-使用B-树索引来模拟Hash索引" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/06/%E4%BD%BF%E7%94%A8B-%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/" class="article-date">
  <time class="dt-published" datetime="2018-04-06T10:53:19.000Z" itemprop="datePublished">2018-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/06/%E4%BD%BF%E7%94%A8B-%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/">使用B+树索引来模拟Hash索引</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>MySQL对于B+树索引的长度是有限制的。如果我们想要在一个很长字符串（例如<code>varchar(255)</code>）上进行查找，就得使用前缀索引。但是有时这样还是会使得索引列键值的可选择性很差。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">abcd</span><br><span class="line">abce</span><br><span class="line">abcf</span><br><span class="line">abcg</span><br></pre></td></tr></table></figure>

<p>不管长度为1还是2还是3，都无法很好的筛选出数据。</p>
<p>要解决这个问题，可以使用Hash索引。但是，并不是所有的储存引擎都支持Hash索引。此时，我们可以<strong>通过B+树索引来模拟Hash索引</strong>。</p>
<p>举个例子：</p>
<p>这里有一张表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;article&#96; (  </span><br><span class="line">  &#96;id&#96; int NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;title&#96; varchar(255) NOT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  KEY &#96;idx_title&#96; (&#96;title&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>

<p>表中有一个字段是一个很长的字符串类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;title&#96; varchar(255) NOT NULL</span><br></pre></td></tr></table></figure>

<p>OK，现在我们开始使用B+树索引来模拟Hash索引。</p>
<p>我们先来往表中插入一些数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO article</span><br><span class="line">(title)</span><br><span class="line">VALUES</span><br><span class="line">(&#39;STL源码剖析&#39;),</span><br><span class="line">(&#39;深入理解Nginx&#39;),</span><br><span class="line">(&#39;Linux高性能服务器编程&#39;),</span><br><span class="line">(&#39;Linux内核设计与实现&#39;),</span><br><span class="line">(&#39;PHP7内核剖析&#39;),</span><br><span class="line">(&#39;Linux多线程服务端编程&#39;),</span><br><span class="line">(&#39;Unix环境高级编程&#39;),</span><br><span class="line">(&#39;TCP&#x2F;IP详解&#39;),</span><br><span class="line">(&#39;深度探索C++对象模型&#39;);</span><br></pre></td></tr></table></figure>

<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E4%BD%BF%E7%94%A8B+%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/1.png"></p>
<p>OK，因为InnoDB储存引擎是不能够人为的去建立Hash索引。所以我们需要在表中新加一个列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table article add title_md5 char(32);</span><br></pre></td></tr></table></figure>

<p>然后为表article的每条记录增加字段<code>title_md5</code>的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update article set title_md5 &#x3D; md5(title);</span><br></pre></td></tr></table></figure>

<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E4%BD%BF%E7%94%A8B+%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/2.png"></p>
<p>因为我们要使用B+树索引来模拟Hash索引，所以，我们还需要为这个<code>title_md5</code>列建立一个索引：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_md5 on article(title_md5);</span><br></pre></td></tr></table></figure>

<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E4%BD%BF%E7%94%A8B+%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/3.png"></p>
<p>接下来，使用这个B+树索引来模拟Hash索引：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from article where title_md5 &#x3D; md5(&#39;STL源码剖析&#39;);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E4%BD%BF%E7%94%A8B+%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/4.png"></p>
<p>然后我们再来使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from article where title_md5 &#x3D; md5(&#39;STL源码剖析&#39;)\G</span><br></pre></td></tr></table></figure>

<p>看看结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E4%BD%BF%E7%94%A8B+%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/5.png"></p>
<p>但是，我们知道，哈希函数是会发生碰撞的，也就是说不同的key可能得到的Hash值相同。即，可能会得到多条数据。所以，我们还需要再增加一个条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from article where title_md5 &#x3D; md5(&#39;STL源码剖析&#39;) and title &#x3D; &#39;STL源码剖析&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E4%BD%BF%E7%94%A8B+%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/6.png"></p>
<p>然后我们再来执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from article where title_md5 &#x3D; md5(&#39;STL源码剖析&#39;) and title &#x3D; &#39;STL源码剖析&#39;\G</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E4%BD%BF%E7%94%A8B+%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/7.png"></p>
<p>我们会发现，在key这一行，是<code>idx_title</code>，也就是说，使用的索引不是<code>idx_md5</code>。其实我这里也有点纳闷，目前还不知道为什么不是使用<code>idx_md5</code>索引。希望知道的小伙伴能够告诉我一下！！</p>
<p>所以我想到的一个方式是为字段<code>title_md5</code>和<code>title</code>建立一个联合索引。</p>
<h2 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h2><ul>
<li><p>和Hash索引一样，只能处理键值的<strong>全值匹配</strong>查找</p>
</li>
<li><p>所使用的Hash函数决定着索引键的大小</p>
<p>如果我们使用的Hash函数生成的Hash值太大，就会造成索引比较大的情况。所以我们需要选取合适的Hash函数，既不能使生成的Hash值太大，也不能造成太多的Hash冲突。</p>
</li>
</ul>
<p>既要在<code>title_md5</code>上做过滤也要在<code>title</code>上做过滤的原因：</p>
<p>为了避免Hash冲突的出现。因为只对<code>title_md5</code>做过滤掉，那么很可能得不到我们真正想要的结果（因为不同的key可能得到的Hash值相同）。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/04/06/%E4%BD%BF%E7%94%A8B-%E6%A0%91%E7%B4%A2%E5%BC%95%E6%9D%A5%E6%A8%A1%E6%8B%9FHash%E7%B4%A2%E5%BC%95/" data-id="ckkj72ztn007tf6vx8lroh8km" data-title="使用B+树索引来模拟Hash索引" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-对于php-的-sleep理解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/03/31/%E5%AF%B9%E4%BA%8Ephp-%E7%9A%84-sleep%E7%90%86%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2018-03-31T02:07:10.000Z" itemprop="datePublished">2018-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/03/31/%E5%AF%B9%E4%BA%8Ephp-%E7%9A%84-sleep%E7%90%86%E8%A7%A3/">对于php 的 sleep理解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天知乎上有人邀请我回答一个问题，问题挺好的。这里分享下。</p>
<p>问题描述是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">比如 我现在有一个方法: a 调用方法:b</span><br><span class="line">b里面是sleep </span><br><span class="line">1分钟之后</span><br><span class="line">向数据库插入一条数据</span><br><span class="line"></span><br><span class="line">用户x在1点的时候 访问了方法a</span><br><span class="line"></span><br><span class="line">用户y在1点0分30秒的时候 访问了方法a</span><br><span class="line"></span><br><span class="line">请问:最终 到1点1分30秒的时候 ，数据库会插入一条数据 ？ 还是两条数据？</span><br><span class="line"></span><br><span class="line">为什么</span><br></pre></td></tr></table></figure>

<p>我的答案：</p>
<p>谢邀</p>
<p>我通过代码来对你讲解吧。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> date(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>, time());</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> date(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>, time());</span><br></pre></td></tr></table></figure>

<p>然后我打开两个页面，同时去请求我的脚本。</p>
<p>结果如下：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E5%AF%B9%E4%BA%8Ephp%20%E7%9A%84%20sleep%E7%90%86%E8%A7%A3/1.png"></p>
<p>看到没？这两次请求都有对应的输出对吧（相当于向数据库里面插入信息）。</p>
<p><strong>重点来了</strong></p>
<p>我明明是同时请求浏览器的，为什么第二次请求被处理的时间是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-03-31 01:07:35</span><br></pre></td></tr></table></figure>

<p>好像是第一次请求被处理完之后结束的时间对吧。</p>
<p>为什么？因为我只开了一个PHP的worker进程：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E5%AF%B9%E4%BA%8Ephp%20%E7%9A%84%20sleep%E7%90%86%E8%A7%A3/2.png"></p>
<p>这意味着什么呢？</p>
<p>因为第一次请求导致了worker进程被挂起了（因为sleep的原因，worker进程处于阻塞态）。所以，此时的worker进程不能去处理客户端的连接。因此，必须等到了第一次请求被处理完了，才可以处理第二次请求。于是第二次请求它被处理的时间是第一次请求被处理完的结束时间。</p>
<p>那么，既然worker进程阻塞了，为什么可以处理实际上在<code>2018-03-31 01:07:05</code>就发来的第二次请求呢（第二次请求和第一次请求是同时发起的）？原因是有Web服务，例如我这里的Nginx。它会去<strong>保持</strong>Nginx于客户端的连接。所以第二次请求可以推迟到<code>2018-03-31 01:07:35</code>再被处理。其实，如果你把我上面代码的sleep时间设置更久一点，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sleep(<span class="number">60</span>);</span><br></pre></td></tr></table></figure>

<p>你会发现，第二次请求很可能会得到一个404状态。</p>
<p>好的，说了这么多，现在回到你的问题。</p>
<p>你是让用户x在1点的时候去请求PHP脚本。然后这时候调用了sleep方法对吧（sleep一分钟）。根据上面我的讲解，worker进程需要等到1点1分才可以去处理用户y实际在1点0分30秒的时候就发来的请求。然后，在1点1分的时候，worker因为sleep而在此被阻塞。直到1点2分才被唤醒，从阻塞态再到就绪态然后才处于可执行状态。然后才可以插入第二条数据。也就是说，到了1点2分的时候，数据库里面才会有第二条数据。</p>
<p>所以，<strong>在1点1分30秒的时候，数据库里面只有一条数据</strong>。</p>
<p>但是，我前面的结论都是在单个worker进程的基础上得到的。如果你的worker进程有多个，假设2个好吧。那么第一个worker进程因为第一次请求在1点钟被阻塞了（直到1点1分第1个worker进程才会被唤醒，然后插入数据）。OK，之后时间到了1点0分30秒，第二个请求发来了，因为第一个worker此时还是处于阻塞态，所以第二个worker进程会去处理这个请求。同样的，第二个worker进程在1点0分30秒被阻塞了（直到1点1分30秒第二个worker进程才会被唤醒，然后插入第二条数据）。因此，最终在1点1分30秒的时候，数据库里面是有两条数据的。</p>
<p>所以在1点1分30秒的时候，数据库里面有几条记录，看情况。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/03/31/%E5%AF%B9%E4%BA%8Ephp-%E7%9A%84-sleep%E7%90%86%E8%A7%A3/" data-id="ckkj72zu8009rf6vxb8wecc2h" data-title="对于php 的 sleep理解" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-聊一聊协程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/03/11/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2018-03-11T15:08:44.000Z" itemprop="datePublished">2018-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/03/11/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/">聊一聊协程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>hello！我发现博客搭建在GitHub上面有点点麻烦，换电脑了，写起博客来够呛的。</p>
<p>首先说说协程是什么吧（后面的内容都是以Go语言实现的来说，不同语言实现的可能不同。我们给Go语言的协程取了一个名字，叫做<strong>goroutine</strong>）。</p>
<p>首先，我们说协程是一个<strong>轻量级的线程</strong>。为什么说是线程呢？因为协程它的一些作用和线程很像。比如说，从客户端来了一个请求，那么我的服务器就可以去创建一个线程来处理这个请求。协程也是类似的，可以并发的去处理一些任务。</p>
<p>但是为什么又说它是轻量级的呢？因为我们可以去开很多个协程是没问题的，比如开1000个协程来做处理任务。但是如果我们去开1000个线程，就会对系统的性能有影响。</p>
<p>而且协程它是非抢占式多任务处理，由协程主动交出控制权。</p>
<p>线程在任何时候都有可能被操作系统切换。哪怕是一条语句执行到一半，也可能会被切换掉。然后操作系统在某个时候又把这个线程切换回来，继续那条语句。而协程不一样，我什么时候想交出对CPU的控制权，什么时候不想，是由协程内部决定的。正是因为这个非抢占式，才能做到轻量级。而抢占式的话，就要处理最坏的情况：我去抢的话，人家的事情正好做到一半，那么要存更多的上下文信息。而非抢占式只需要处理其中切换的几个点就行了。这样对资源的消耗就会小一点。</p>
<p>还有一点就是协程是编译器/解释器/虚拟机层面的多任务。它不是操作系统层面的一个多任务。在Go语言中，可以看成是编译器级别的多任务，编译器会把我们的<code>go func</code>（后面会解释这个 go func）来解释为一个协程。具体在执行上，Go语言会有一个调度器来调度我们的协程。我们操作系统本身有一个调度器，Go语言里面有它自己的调度器来调度我们轻量级的线程，即协程。</p>
<p>OK，现在我们来实际操作一下协程，感受一把。</p>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> spinner(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">	<span class="keyword">const</span> n = <span class="number">45</span></span><br><span class="line">	fibN := fib(n) <span class="comment">// slow</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;\rFibonacci(%d) = %d\n&quot;</span>, n, fibN)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spinner</span><span class="params">(delay time.Duration)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> _, r := <span class="keyword">range</span> <span class="string">`-\|/`</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;\r%c&quot;</span>, r)</span><br><span class="line">			time.Sleep(delay)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fib</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> x &lt; <span class="number">2</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> x</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> fib(x<span class="number">-1</span>) + fib(x<span class="number">-2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/1.gif"></p>
<p>其中，这个动画效果是<code>spinner</code>这个函数导致的，而我们的这个<code>fib</code>是原来计算斐波那契数列的。很明显，这两个函数不是你先我后地执行的，而是并发执行的。因为，如果这两个函数是你先我后执行的，那么因为<code>spinner</code>函数是无限循环，所以<code>fib</code>函数是不可能会得到执行的，也就不会得到数列的值。</p>
<p>那么，这段代码是如何做到并发的执行的呢？看上去就是在main函数里面调用了两个函数而已啊。仔细看看，不难发现，在调用函数<code>spinner</code>的时候，前面加了go这个关键字。这是因为加了go关键字，所以就相当于<strong>创建了一个协程</strong>。当一个程序启动时，其主函数即在一个单独的goroutine中运行，我们叫它main goroutine。</p>
<p>OK，知道了上面的这些知识后，我们来说一下spinner协程是如何结束无限循环的。首先一点就是，<strong>当main 协程退出时，这个程序的其他协程都会退出</strong>。所以，在spinner无限循环的情况下，一定是因为main 协程退出了。否则这个循环的过程不会结束。</p>
<p>我们可以简单的来测试一下，我在main 函数的末尾写一个无限循环：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> spinner(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">	<span class="keyword">const</span> n = <span class="number">45</span></span><br><span class="line">	fibN := fib(n) <span class="comment">// slow</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;\rFibonacci(%d) = %d\n&quot;</span>, n, fibN)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spinner</span><span class="params">(delay time.Duration)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> _, r := <span class="keyword">range</span> <span class="string">`-\|/`</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;\r%c&quot;</span>, r)</span><br><span class="line">			time.Sleep(delay)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fib</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">		a := <span class="number">1</span></span><br><span class="line">		a++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/2.gif"></p>
<p>可以看到，spinner协程一直没有结束。</p>
<p>OK，我们前面也说了，协程可以自己来控制是否要切换，现在我们在做个测试吧：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> func1()</span><br><span class="line">    func2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func1</span> <span class="params">()</span></span> &#123;</span><br><span class="line">	runtime.Gosched()</span><br><span class="line">	fmt.Println(<span class="string">&quot;func1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func2</span> <span class="params">()</span></span>  &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func2&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/3.png"></p>
<p>可以看出，在执行func1这个协程的时候，我们使用了<code>runtime.Gosched()</code>来交出控制权，从而停止了func1协程的执行。然后看到，main协程打印出了字符串“func2”。但是我们发现没有打印出字符串“func1”对吧。这个也很好解释：字符串“func1”还没来得及打印，main协程就已经退出了，所以func1协程还没打印出字符串“func1”就已经退出了。</p>
<p>那么是不是说因为<code>runtime.Gosched()</code>的作用，func1协程被切换为了main协程呢（即，和函数调用一样func1和main两个协程并不是并发执行的）？我们来做个实验：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> func1()</span><br><span class="line">    func2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func1</span> <span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func1 1&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">		a := <span class="number">1</span></span><br><span class="line">		a++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;func1 2&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func2</span> <span class="params">()</span></span>  &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func2&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/4.png"></p>
<p>可以看到，我使用<code>go func1()</code>开了一个func1协程。然后main继续执行，打印出字符串“func2”，然后main结束。但是我们这次还是没有看到字符串“func1 1”被打印出来。所以，还是有可能两个协程是顺序执行的对吧。所以，我们这次让main协程慢一点退出，给func1协程一点表现的机会看看。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">go</span> func1()</span><br><span class="line">    func2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func1</span> <span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func1 1&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">		a := <span class="number">1</span></span><br><span class="line">		a++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;func1 2&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func2</span> <span class="params">()</span></span>  &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;func2&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++ &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/5.png"></p>
<p>可以看出，在func2循环的时候，func1协程在运行。并且因为func1中有一个无限循环，但是func1并没有交出控制权，进程却退出了，说明func2函数的循环执行完了，导致main函数结束。所以func1协程也退出了。</p>
<p>因此，我们可以看出，main协程和func1协程是并发执行的。并不是函数调用那样同步的，即不是你先我后的顺序。也就是说：上面的<code>runtime.Gosched()</code>并不是去调用main协程，因为main协程本来就在执行。所以<code>runtime.Gosched()</code>只是去交出控制权，让调度器可以把其他协程调度进来。</p>
<p>好的，接下来，我们开1000个协程试试吧：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> func1()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line">		i := <span class="number">1</span></span><br><span class="line">		i++</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func1</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们通过 <code>top</code>命令来看看结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/6.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/03/11/%E8%81%8A%E4%B8%80%E8%81%8A%E5%8D%8F%E7%A8%8B/" data-id="ckkj72zv000bpf6vx94nyd3jm" data-title="聊一聊协程" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-SQL注入" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/02/26/SQL%E6%B3%A8%E5%85%A5/" class="article-date">
  <time class="dt-published" datetime="2018-02-26T07:21:50.000Z" itemprop="datePublished">2018-02-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/02/26/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>大家应该都听说过SQL注入吧，但是，网络上的例子貌似都是一些<strong>代码片段</strong>，如果一个新手想要自己尝试一下SQL注入来直观的感受一下SQL注入的危害，显得很无助。我刚学习这方面知识的时候也苦苦找不到这样的代码。最近在知乎上看到很多人都提关于SQL注入的问题，于是，打算写一篇这样的博客。</p>
<p>直接上代码：</p>
<p>先创建数据表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS &#96;users&#96;(</span><br><span class="line">   &#96;id&#96; INT UNSIGNED AUTO_INCREMENT,</span><br><span class="line">   &#96;username&#96; varchar(200) NOT NULL,</span><br><span class="line">   &#96;password&#96; CHAR(32) NOT NULL,</span><br><span class="line">   PRIMARY KEY ( &#96;id&#96; )</span><br><span class="line">)ENGINE &#x3D; InnoDB DEFAULT CHARSET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;users&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;) VALUES</span><br><span class="line">(1, &#39;admin&#39;, MD5(&#39;admin&#39;)),</span><br><span class="line">(2, &#39;huanghantao&#39;, MD5(&#39;huanghantao&#39;));</span><br></pre></td></tr></table></figure>

<p>下面是结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/SQL%E6%B3%A8%E5%85%A5/1.png"></p>
<p>（密码是结果md5函数加密的）</p>
<p>然后是PHP脚本处理登录逻辑的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">$username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;&quot;</span>;</span><br><span class="line">$dbname = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建连接</span></span><br><span class="line">$conn = <span class="keyword">new</span> mysqli($servername, $username, $password, $dbname);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 检测连接</span></span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;连接失败: &quot;</span> . $conn-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line">$sql = <span class="string">&quot;SELECT * FROM users where username = &#x27;&quot;</span> . $username . <span class="string">&quot;&#x27; AND password = &#x27;&quot;</span> . md5($password) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">$result_obj = $conn-&gt;query($sql);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($result_obj-&gt;num_rows) &#123;</span><br><span class="line">	<span class="keyword">while</span>($row = $result_obj-&gt;fetch_assoc()) &#123;</span><br><span class="line">		var_dump($row);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OK，程序大概就是这样了，</p>
<p>现在我们执行上面这段PHP脚本：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/SQL%E6%B3%A8%E5%85%A5/2.png"></p>
<p>嗯，符合我们的预期。（因为用户名和密码都正确，所以打印出了用户的结果）</p>
<p>好的，接下来开始我们的表演：</p>
<p>我们修改一下PHP脚本的username变量：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$username = <span class="string">&quot;admin&#x27; --&quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;密码随便写&quot;</span>; <span class="comment">// 没错，你写中文也行</span></span><br></pre></td></tr></table></figure>

<p>完整代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$servername = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">$username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;&quot;</span>;</span><br><span class="line">$dbname = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建连接</span></span><br><span class="line">$conn = <span class="keyword">new</span> mysqli($servername, $username, $password, $dbname);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 检测连接</span></span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;连接失败: &quot;</span> . $conn-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = <span class="string">&quot;admin&#x27; --&quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;代码随便写&quot;</span>;</span><br><span class="line">$sql = <span class="string">&quot;SELECT * FROM users where username = &#x27;&quot;</span> . $username . <span class="string">&quot;&#x27; AND password = &#x27;&quot;</span> . md5($password) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">$result_obj = $conn-&gt;query($sql);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($result_obj-&gt;num_rows) &#123;</span><br><span class="line">	<span class="keyword">while</span>($row = $result_obj-&gt;fetch_assoc()) &#123;</span><br><span class="line">		var_dump($row);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们执行代码：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/SQL%E6%B3%A8%E5%85%A5/3.png"></p>
<p>说的是<code>$result_obj</code>变量不是一个对象，所以没有属性。好的，我们打印一下<code>$result_obj</code>看看它究竟是什么：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump($result_obj);</span><br></pre></td></tr></table></figure>

<p><img src="http://oklbfi1yj.bkt.clouddn.com/SQL%E6%B3%A8%E5%85%A5/4.png"></p>
<p>原来返回的是一个boolean类型的变量。说明我们的SQL语句没有执行成功。这就是很坑的一个地方了，网络上的文章大多数是草草的告诉我们，在表单填写类似这样的东西就可以了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; --</span><br></pre></td></tr></table></figure>

<p>即加个单引号 <code>&#39;</code>，加两个 <code>-</code>。实际上，或许你得再加点东西。</p>
<p>我们修改下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$username = <span class="string">&quot;admin&#x27; -- // &quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;代码随便写&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>也就是说再加两个<code>/</code>。</p>
<p>好的，我们执行一下代码：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/SQL%E6%B3%A8%E5%85%A5/5.png"></p>
<p>怎么样，就算我们不知道密码，只要我们知道这个用户的用户名，就可以登录到这个用户的页面对吧。</p>
<p>好的，接下来，我们再试试，即使没有用户名和密码，我们也可以得到所有用户的用户名和密码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$username = <span class="string">&quot;&#x27; or 1 -- // &quot;</span>;</span><br><span class="line">$password = <span class="string">&quot;代码随便写&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>执行后的结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/SQL%E6%B3%A8%E5%85%A5/6.png"></p>
<p>很可怕对吧。</p>
<p>至于这两段代码中的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin&#39; --</span><br><span class="line">和</span><br><span class="line">&#39; or 1 --</span><br></pre></td></tr></table></figure>

<p>什么意思，网上的文章已经讲烂了，就不多说了。</p>
<p>通过什么的操作，我们可以发现，那个单引号<code>&#39;</code>特别捣蛋对吧，所以，我们修改下代码，对单引号进行转义：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$username = <span class="string">&quot;&#x27; or 1 -- // &quot;</span>;</span><br><span class="line">$username = addslashes($username);</span><br><span class="line">$password = <span class="string">&quot;代码随便写&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>执行后的结果：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/SQL%E6%B3%A8%E5%85%A5/7.png"></p>
<p>可以看到，并没有打印出用户信息，所以这个函数阻挡了此次攻击。原因如下：</p>
<p><img src="http://oklbfi1yj.bkt.clouddn.com/SQL%E6%B3%A8%E5%85%A5/8.png"></p>
<p><code>or</code>前面的单引号被转义了。</p>
<p>但是，并不建议通过<code>addslashes</code>对单引号转义的方式来阻挡这种类型的SQL注入。因为**addslashes对有些特殊字符后跟上’（单引号）并不会加把这个’变成/‘**。</p>
<p>这也是为什么很多人建议使用PDO来对数据库进行操作的原因了。</p>
<p>好的，文章到这里结束了，希望对大家有所帮助。文中的代码都可以复制后直接使用，希望可以减少大家踩坑的时间。</p>
<p>happy ending……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/02/26/SQL%E6%B3%A8%E5%85%A5/" data-id="ckkj72zry003ff6vx727p1aeo" data-title="SQL注入" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2018年寒假总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/02/21/2018%E5%B9%B4%E5%AF%92%E5%81%87%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2018-02-20T16:11:14.000Z" itemprop="datePublished">2018-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/02/21/2018%E5%B9%B4%E5%AF%92%E5%81%87%E6%80%BB%E7%BB%93/">2018年寒假总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>很快，一个寒假就过去了。这个寒假主要是看书和刷算法题。因为阅读了一些计算机书籍，所以计算机基础更加扎实了一些。和DFS有关的算法写得也还可以了（从内存模型的角度去理解递归），动态规划也可以写一写模板题了（说到动态规划，美团今年秋招的四道编程题都是动态规划……）。还有就是入手了一个Mac Pro，贼贵，现在我还要分期两年还1W块钱。so，得好好学习啊，不然电脑都换不起，以后还怎么“养”女票，做外包也得“养”。春招加油！！</p>
<p>这个寒假看了三本新书《深入理解Nginx:模块开发与架构解析》、《Redis设计与实现》、《MySQL技术内幕–InnoDB储存引擎》。同时还回味了一遍《深入理解PHP内核》、《Linux内核设计与实现》。</p>
<p>看了这些书，收获很多，在这里我就不列举有哪些知识点了，因为书中都有。关键是自己要去看。我相信大家更关心的是看这些书需要具备哪些<strong>潜在的知识</strong>。</p>
<h2 id="潜在知识"><a href="#潜在知识" class="headerlink" title="潜在知识"></a>潜在知识</h2><p>C语言，推荐书籍：<strong>《C Primer Plus》</strong>，静下心来，有编程基础可以3天过完。</p>
<p>数据结构，推荐书籍：<strong>《图解数据结构》</strong>。只用看到二叉树那里即可，图不用看。静下心来2个星期可以看完。</p>
<p>Linux操作系统，至少要懂得如何下载源代码、编译源代码即可。如果懂得Linux的原理就会更好了，对于Nginx的内存管理的理解会有帮助。推荐书籍：<strong>《Linux内核设计与实现》</strong>。静下心来两个星期可以看完。</p>
<p>计算机网络，推荐书籍：<strong>谢希仁的那本计算机网络</strong>。重点看网络层、传输层、应用层这三部分。静下心来一个星期可以看完。</p>
<p>网络编程，也就是对于计算机网络知识的实战，推荐书籍：<strong>《Unix网络编程》</strong>。重点学习IO多路复用。静下心来2个星期可以看完。</p>
<p>可以说，上面的知识，只要是搞服务端开发的，不管是做应用层还是传输层/网络层，都是需要学习的，这对以后面临更大挑战的时候有很大的帮助，因为它可以帮助我们理解工具的本质，当出现问题的时候，可以更快的分析、解决，而不是盲目。</p>
<p>学习这些内容的时候多动手敲代码，多谷歌和百度，可以加深我们对知识点的理解。</p>
<p>尽量按照上面的顺序学习，因为有一些东西有联系。</p>
<p>希望可以帮助到大家……</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://huanghantao.github.io/2018/02/21/2018%E5%B9%B4%E5%AF%92%E5%81%87%E6%80%BB%E7%BB%93/" data-id="ckkj72zqd0003f6vxfxhdd899" data-title="2018年寒假总结" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/16/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/18/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Boost/" rel="tag">Boost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Composer/" rel="tag">Composer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag">C语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dockerfile/" rel="tag">Dockerfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hyperf/" rel="tag">Hyperf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/I-O%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" rel="tag">I/O多路复用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JIT/" rel="tag">JIT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Laravel/" rel="tag">Laravel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MacOS/" rel="tag">MacOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OPcache/" rel="tag">OPcache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP-%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91/" rel="tag">PHP 扩展开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP7/" rel="tag">PHP7</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP%E5%86%85%E6%A0%B8/" rel="tag">PHP内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP%E6%89%A9%E5%B1%95/" rel="tag">PHP扩展</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91/" rel="tag">PHP扩展开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/" rel="tag">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Protobuf/" rel="tag">Protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPC/" rel="tag">RPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swoole/" rel="tag">Swoole</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swoole%E5%BE%AE%E8%AF%BE%E7%A8%8B/" rel="tag">Swoole微课程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vscode/" rel="tag">Vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xdebug/" rel="tag">Xdebug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/composer/" rel="tag">composer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c%E8%AF%AD%E8%A8%80/" rel="tag">c语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-compose/" rel="tag">docker-compose</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/epoll/" rel="tag">epoll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fpm/" rel="tag">fpm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gqlgen/" rel="tag">gqlgen</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/" rel="tag">leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/migrate/" rel="tag">migrate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swoole/" rel="tag">swoole</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swore/" rel="tag">swore</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tinyswoole/" rel="tag">tinyswoole</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unique-lock/" rel="tag">unique_lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-js/" rel="tag">vue.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%8F%E7%A8%8B/" rel="tag">协程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F/" rel="tag">外部排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/" rel="tag">多线程编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/" rel="tag">引用计数</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD/" rel="tag">性能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag">性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" rel="tag">性能分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91/" rel="tag">服务器开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" rel="tag">服务器编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" rel="tag">汇编语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F/" rel="tag">秒杀系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B/" rel="tag">线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" rel="tag">线程池</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A0%81/" rel="tag">编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" rel="tag">编译原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/" rel="tag">编译器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" rel="tag">网络编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" rel="tag">虚拟机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag">计算机基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/" rel="tag">计算机系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E8%AF%BB%E4%BB%A3%E7%A0%81/" rel="tag">读读代码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B0%83%E8%AF%95/" rel="tag">调试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">递归</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%94%81/" rel="tag">锁</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Boost/" style="font-size: 10px;">Boost</a> <a href="/tags/C/" style="font-size: 11.54px;">C</a> <a href="/tags/C/" style="font-size: 16.92px;">C++</a> <a href="/tags/Composer/" style="font-size: 10px;">Composer</a> <a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 15.38px;">C语言</a> <a href="/tags/Docker/" style="font-size: 11.54px;">Docker</a> <a href="/tags/Dockerfile/" style="font-size: 10px;">Dockerfile</a> <a href="/tags/GRPC/" style="font-size: 10.77px;">GRPC</a> <a href="/tags/Golang/" style="font-size: 10px;">Golang</a> <a href="/tags/GraphQL/" style="font-size: 10px;">GraphQL</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hyperf/" style="font-size: 10.77px;">Hyperf</a> <a href="/tags/I-O%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" style="font-size: 10.77px;">I/O多路复用</a> <a href="/tags/JIT/" style="font-size: 10px;">JIT</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Laravel/" style="font-size: 10px;">Laravel</a> <a href="/tags/Linux/" style="font-size: 17.69px;">Linux</a> <a href="/tags/MacOS/" style="font-size: 10px;">MacOS</a> <a href="/tags/MySQL/" style="font-size: 10.77px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/OPcache/" style="font-size: 10px;">OPcache</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/PHP-%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91/" style="font-size: 10.77px;">PHP 扩展开发</a> <a href="/tags/PHP7/" style="font-size: 10px;">PHP7</a> <a href="/tags/PHP%E5%86%85%E6%A0%B8/" style="font-size: 17.69px;">PHP内核</a> <a href="/tags/PHP%E6%89%A9%E5%B1%95/" style="font-size: 13.85px;">PHP扩展</a> <a href="/tags/PHP%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91/" style="font-size: 12.31px;">PHP扩展开发</a> <a href="/tags/PostgreSQL/" style="font-size: 10px;">PostgreSQL</a> <a href="/tags/Protobuf/" style="font-size: 10.77px;">Protobuf</a> <a href="/tags/RPC/" style="font-size: 10px;">RPC</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Swoole/" style="font-size: 19.23px;">Swoole</a> <a href="/tags/Swoole%E5%BE%AE%E8%AF%BE%E7%A8%8B/" style="font-size: 10px;">Swoole微课程</a> <a href="/tags/Vscode/" style="font-size: 10px;">Vscode</a> <a href="/tags/Xdebug/" style="font-size: 10.77px;">Xdebug</a> <a href="/tags/c/" style="font-size: 10.77px;">c++</a> <a href="/tags/composer/" style="font-size: 10px;">composer</a> <a href="/tags/c%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">c语言</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/docker-compose/" style="font-size: 10px;">docker-compose</a> <a href="/tags/epoll/" style="font-size: 10px;">epoll</a> <a href="/tags/fpm/" style="font-size: 10px;">fpm</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/gqlgen/" style="font-size: 10px;">gqlgen</a> <a href="/tags/leetcode/" style="font-size: 12.31px;">leetcode</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/migrate/" style="font-size: 10px;">migrate</a> <a href="/tags/nginx/" style="font-size: 10.77px;">nginx</a> <a href="/tags/php/" style="font-size: 16.15px;">php</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/swoole/" style="font-size: 16.15px;">swoole</a> <a href="/tags/swore/" style="font-size: 10px;">swore</a> <a href="/tags/tinyswoole/" style="font-size: 10px;">tinyswoole</a> <a href="/tags/unique-lock/" style="font-size: 10px;">unique_lock</a> <a href="/tags/vue-js/" style="font-size: 10.77px;">vue.js</a> <a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size: 12.31px;">其他</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E5%8D%8F%E7%A8%8B/" style="font-size: 16.15px;">协程</a> <a href="/tags/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">外部排序</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">多线程编程</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 10px;">并发</a> <a href="/tags/%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/" style="font-size: 10px;">引用计数</a> <a href="/tags/%E6%80%A7%E8%83%BD/" style="font-size: 10px;">性能</a> <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 10px;">性能优化</a> <a href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" style="font-size: 10px;">性能分析</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 13.85px;">操作系统</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10.77px;">数据结构</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%80%E5%8F%91/" style="font-size: 13.08px;">服务器开发</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">服务器编程</a> <a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">汇编语言</a> <a href="/tags/%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">秒杀系统</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15.38px;">算法</a> <a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">线程</a> <a href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" style="font-size: 10px;">线程池</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size: 10px;">编码</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 18.46px;">编译原理</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/" style="font-size: 10px;">编译器</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" style="font-size: 14.62px;">网络编程</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 10px;">虚拟机</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">计算机基础</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">计算机系统</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10.77px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10.77px;">设计模式</a> <a href="/tags/%E8%AF%BB%E8%AF%BB%E4%BB%A3%E7%A0%81/" style="font-size: 10.77px;">读读代码</a> <a href="/tags/%E8%B0%83%E8%AF%95/" style="font-size: 10px;">调试</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size: 10px;">递归</a> <a href="/tags/%E9%94%81/" style="font-size: 10px;">锁</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/07/%E5%9C%A8PHP-RSHUTDOWN%E9%98%B6%E6%AE%B5%E8%B0%83%E7%94%A8zend-bailout%E5%AF%BC%E8%87%B4zend-mm-heap-corrupted%E9%97%AE%E9%A2%98/">在PHP RSHUTDOWN阶段调用zend_bailout导致zend_mm_heap corrupted问题</a>
          </li>
        
          <li>
            <a href="/2021/01/07/PHP%E6%89%A9%E5%B1%95%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7%E7%9A%84%E5%90%8D%E5%AD%97/">PHP扩展如何获取私有属性的名字</a>
          </li>
        
          <li>
            <a href="/2020/12/16/PHP%E6%89%A9%E5%B1%95%E5%A6%82%E4%BD%95%E5%8E%BB%E6%A3%80%E6%9F%A5%E4%BE%9D%E8%B5%96%E7%9A%84C-%E5%BA%93%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8/">PHP扩展如何去检查依赖的C++库是否存在</a>
          </li>
        
          <li>
            <a href="/2020/11/24/Swoole-native-curl%E5%8D%8F%E7%A8%8B%E5%8C%96%E6%80%9D%E8%B7%AF/">Swoole native curl协程化思路</a>
          </li>
        
          <li>
            <a href="/2020/11/22/%E6%9A%B4%E5%8A%9B%E7%94%9F%E6%88%90%E6%94%AF%E9%85%8D%E6%A0%91/">暴力生成支配树</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 codinghuang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>