---
title: 虚拟机设计与实现--虚拟机组成
date: 2020-11-06 00:32:25
tags:
- 虚拟机
---

```bash
                               ┌─────────────────────────────┐                                                            
                               │                             │                                                            
                               │                             │               ┌─────────────────────────────────────────┐  
                               │                             │               │                                         │  
                          ┌───▶│ Loaders and dynamic linkers │──────────────▶│For example, convert symbols to addresses│  
                          │    │                             │               │                                         │  
                          │    │                             │               └─────────────────────────────────────────┘  
                          │    │                             │                                                            
                          │    └─────────────────────────────┘                                                            
                          │                                                                                               
                          │                                                                                               
                          │                                                                                               
                          │                                                                                               
                          │    ┌─────────────────────────────┐                                                            
                          │    │                             │                                                            
                          │    │                             │            ┌─────────────────────────────────────────┐     
                          │    │                             │            │                                         │     
                          ├───▶│      Execution engine       │───────────▶│     Execute opcode or machine code      │     
                          │    │                             │            │                                         │     
┌────────────────────┐    │    │                             │            └─────────────────────────────────────────┘     
│                    │    │    │                             │                                                            
│                    │    │    └─────────────────────────────┘                                                            
│                    │    │                                                                                               
│  virtual machine   │    │                                               ┌─────────────────────────────────────────┐     
│                    │────┤                                               │Use traditional memory managers, such as │     
│                    │    │                                        ┌─────▶│  malloc and Free. Focus more on memory  │     
│                    │    │                                        │      │               allocation                │     
│                    │    │    ┌─────────────────────────────┐     │      └─────────────────────────────────────────┘     
└────────────────────┘    │    │                             │     │                                                      
                          │    │                             │     │                                                      
                          │    │                             │     │                                                      
                          ├───▶│       Memory manager        │─────┤                                                      
                          │    │                             │     │                                                      
                          │    │                             │     │                                                      
                          │    │                             │     │      ┌──────────────────────────────────────────────┐
                          │    └─────────────────────────────┘     │      │   Or use the virtual machine's own memory    │
                          │                                        │      │ allocation strategy to pay more attention to │
                          │                                        └─────▶│  memory recovery. For example, the garbage   │
                          │                                               │                  collector                   │
                          │                                               │                                              │
                          │                                               └──────────────────────────────────────────────┘
                          │                                                                                               
                          │     ┌─────────────────────────────┐                                                           
                          │     │                             │           ┌──────────────────────────────────────────────┐
                          │     │                             │           │                                              │
                          │     │                             │           │                                              │
                          └────▶│          extension          │──────────▶│                     FFI                      │
                                │                             │           │                                              │
                                │                             │           │                                              │
                                │                             │           └──────────────────────────────────────────────┘
                                └─────────────────────────────┘                                                           
```
