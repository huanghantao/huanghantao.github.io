---
title: 支配树的生成
date: 2020-11-18 23:21:12
tags:
- 编译器
---

假设我们有如下代码：

```txt
a = 0
b = 5

for i = 1 to b
    a = a + 1

if b then
    a = a - 1
else
    a = a + 1
```

那么，可以得到如下基本块：

```bash
                                    ┌───────────────────────────────────┐                                                                  
                                    │           bb0 -- entry            │                                                                  
                                    │                                   │                                                                  
                                    │              a_0 = 0              │                                                                  
                                    │              b_0 = 5              │                                                                  
                                    │              i_0 = 1              │                                                                  
                                    └───────────────────────────────────┘                                                                  
                                                      │                                                                                    
                                                      │                                                                                    
                                                      │                                                                                    
                                                      │                                                                                    
                                                      │                                                                                    
                                                      │                                                                                    
                                                      │                                                                                    
                                                      ▼                                                                                    
                                    ┌───────────────────────────────────┐                                                                  
                                    │         bb1  -- loop_cond         │                                                                  
                                    │                                   │                                                                  
┌──────────────────────────────────▶│             i_1 = i_0             │                                                                  
│                                   │             a_1 = a_0             │                                                                  
│                                   │                                   │                                                                  
│                                   └───────────────────────────────────┘                                                                  
│                                                     │                                                                                    
│                                                     │                                                                                    
│                                                     │                                                                                    
│                                                     │                                                                                    
│                                                     ▼                                                                                    
│                                                     Λ                                                                                    
│                                                    ╱ ╲                                                                                   
│                                                   ╱   ╲                                                                                  
│                                                  ╱     ╲                                                                                 
│                                                 ╱       ╲                                                                                
│                                                ╱         ╲                                                                               
│                                               ╱┌─────────┐╲                                                                              
│                    ┌────────true─────────────▕ │b_0 - i_1│ ▏──────────false────────────┐                                                 
│                    │                          ╲└─────────┘╱                            │                                                 
│                    │                           ╲         ╱                             │                                                 
│                    │                            ╲       ╱                              │                                                 
│                    │                             ╲     ╱                               │                                                 
│                    │                              ╲   ╱                                │                                                 
│                    │                               ╲ ╱                                 │                                                 
│                    │                                V                                  │                                                 
│                    │                                                                   │                                                 
│                    │                                                                   │                                                 
│                    ▼                                                                   ▼                                                 
│  ┌───────────────────────────────────┐                               ┌───────────────────────────────────┐                               
│  │         bb2 -- loop_body          │                               │         bb3 -- loop_cont          │                               
│  │                                   │                               │                                   │                               
└──│           a_2 = a_1 + 1           │                               │                                   │                               
   │           i_2 = i_1 + 1           │                               │                                   │                               
   │                                   │                               │                                   │                               
   └───────────────────────────────────┘                               └───────────────────────────────────┘                               
                                                                                         │                                                 
                                                                                         │                                                 
                                                                                         │                                                 
                                                                                         ▼                                                 
                                                                                         Λ                                                 
                                                                                        ╱ ╲                                                
                                                                                       ╱   ╲                                               
                                                                                      ╱     ╲                                              
                                                                                     ╱       ╲                                             
                                                                                    ╱         ╲                                            
                                                                                   ╱┌─────────┐╲                                           
                                                         ┌─────true───────────────▕ │   b_0   │ ▏───────────────false───┐                  
                                                         │                         ╲└─────────┘╱                        │                  
                                                         │                          ╲         ╱                         │                  
                                                         │                           ╲       ╱                          │                  
                                                         │                            ╲     ╱                           │                  
                                                         │                             ╲   ╱                            │                  
                                                         │                              ╲ ╱                             │                  
                                                         │                               V                              │                  
                                                         │                                                              │                  
                                                         │                                                              │                  
                                                         ▼                                                              ▼                  
                                       ┌───────────────────────────────────┐                          ┌───────────────────────────────────┐
                                       │           bb4  -- then            │                          │            bb5 -- else            │
                                       │                                   │                          │                                   │
                                       │           a_3 = a_1 - 1           │                          │           a_4 = a_1 + 1           │
                                       │                                   │                          │                                   │
                                       │                                   │                          │                                   │
                                       └───────────────────────────────────┘                          └───────────────────────────────────┘
                                                         │                                                              │                  
                                                         │                                                              │                  
                                                         └───────────────────────────────┬──────────────────────────────┘                  
                                                                                         │                                                 
                                                                                         │                                                 
                                                                                         ▼                                                 
                                                                       ┌───────────────────────────────────┐                               
                                                                       │          bb6 -- if_cont           │                               
                                                                       │                                   │                               
                                                                       │                                   │                               
                                                                       │                                   │                               
                                                                       │                                   │                               
                                                                       └───────────────────────────────────┘                               
```
