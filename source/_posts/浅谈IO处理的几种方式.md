---
title: 浅谈IO处理的几种方式
date: 2018-01-29 21:36:09
tags:
---

## 一、read阻塞方式

只能处理一个文件描述符。此时，如果进程阻塞在了某个文件描述符上面，则这个进程就不可以处理其他已经就绪的文件描述符。必须要等待这个文件描述符变活跃了，且被进程处理完了，这个进程才能处理其他文件描述符。（在这个进程阻塞的过程中，其他进程可以被切换过来。也就是说服务器这边没啥大问题，但是会导致客户端那边久等）

## 二、read非阻塞方式

可以不断地循环检测所有的文件描述符，直到处理完这个文件描述符。这样就不会阻塞在这个文件描述符上面了。
如果这些文件描述符只是偶尔不活跃，用这种方式也是可以的。但是，如果这些文件描述符长时间处于不活跃的状态，就会浪费CPU，CPU一直循环地检测一些还没就绪的文件描述符，做无用功。
（在时间片用完前，其他进程可能不能够被切换进来，导致CPU浪费。也就是说客户端那边不会等太久，但是服务器这边会浪费资源）

## 三、多进程+上面的其中一种方式

由一个主进程负责调度子进程来处理文件描述符。如果是进程池，那么还是会遇到上面两种方式的问题；如果是每次处理一个文件描述符的时候都创建一个新的进程来处理，那么会非常消耗服务器资源（内存有限且CPU有限）。

## 四、IO多路复用方式

第一种方式的问题是进程不可以处理那些已经就绪好了的文件描述符，第二种方式的问题是，CPU一直在做无用的计算。第三种方式是可能会耗服务器资源。所以，我们聪明的程序员就发明了这种先收集就绪的文件描述符，再处理的方式。